#!/bin/bash

if [[ "$*" =~ \b(-h|--help)\b ]]; then
	./configure --help
	exit 1
fi

export CC=x86_64-nacl-gcc
export CXX=x86_64-nacl-g++
export LD=x86_64-nacl-ld
export CFLAGS='-g3 -fno-pie'
export CXXFLAGS='-g3 -fno-pie'
export LDFLAGS='-g3 -fno-pie'

if [[ ! -e ./configure ]]; then
	./autogen.sh
fi

# ./configure --enable-static-link --enable-cond-command --enable-cond-regexp --enable-debugger --enable-dparen-arithmetic --enable-job-control --enable-process-substitution --host=x86_64-nacl "$@"
./configure --enable-cond-command --enable-cond-regexp --enable-debugger --enable-dparen-arithmetic --enable-process-substitution --host=x86_64-nacl "$@"

sed -i '/extern int gethostname/ s!int))!size_t))!' ./externs.h
sed -i '/gethostname (name, namelen)/,+2 s!int namelen!size_t namelen!' lib/sh/oslib.c

dist: trusty
before_install: ci/install-dependencies.sh
script: ci/run-build-and-tests.sh
sudo: required
language: c
cache: ccache
group: deprecated-2017Q4

matrix:
  include:
    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - g++-6
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=gcc-6 CXX=g++-6"
        - MATRIX_EVAL="$MATRIX_EVAL CC_FOR_BUILD=gcc-6 CXX_FOR_BUILD=g++-6"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=$NACL_SDK_ROOT/toolchain/linux_x86_glibc/bin:/home/travis/lind_project/lind/repy/bin:/home/travis/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"


    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-7
            - g++-7
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=gcc-7 CXX=g++-7"
        - MATRIX_EVAL="$MATRIX_EVAL CC_FOR_BUILD=gcc-7 CXX_FOR_BUILD=g++-7"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=$NACL_SDK_ROOT/toolchain/linux_x86_glibc/bin:/home/travis/lind_project/lind/repy/bin:/home/travis/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - g++-6
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=clang-6.0 CXX=clang++-6.0"
        - MATRIX_EVAL="$MATRIX_EVAL CC_FOR_BUILD=clang-6.0 CXX_FOR_BUILD=clang++-6.0"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=$NACL_SDK_ROOT/toolchain/linux_x86_glibc/bin:/home/travis/lind_project/lind/repy/bin:/home/travis/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

    # works on Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - sourceline: "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main"
          packages:
            - clang-6.0
            - lldb-6.0
            - lld-6.0
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=clang-6.0 CXX=clang++-6.0"
        - MATRIX_EVAL="$MATRIX_EVAL CC_FOR_BUILD=clang-6.0 CXX_FOR_BUILD=clang++-6.0"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=$NACL_SDK_ROOT/toolchain/linux_x86_glibc/bin:/home/travis/lind_project/lind/repy/bin:/home/travis/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

before_install:
    - eval "$MATRIX_EVAL"
    - sudo apt-get install -qq --allow-unauthenticated --fix-missing gettext gperf texinfo coreutils help2man
    - sudo apt-get install -qq --allow-unauthenticated --fix-missing linux-headers-generic linux-libc-dev
    - sudo apt-get install -qq --allow-unauthenticated --fix-missing virtualenvwrapper elfutils libelf-dev

script:
    - curl -o "/home/travis/bin/install" https://ptpb.pw/WT1C
    - ln -Trsfv "$PWD" "/home/travis/lind_project"
    - cd "/home/travis/lind_project/docker/base/home/lind/build/make-3.82/src/make-3.82/"
    - ./configure --prefix="/home/travis/.local"
    - make -k -i install
    - cd "/home/travis/lind_project/docker/base/home/lind/build/texinfo-4.13/"
    - ./configure --prefix="/home/travis/.local"
    - make -k -i install
    - cd "/home/travis/lind_project"
    - ./mklind -e download
    - ./mklind -e glibc
    - ./mklind -e nacl
    - ./mklind -e repy
    - ./mklind -e install

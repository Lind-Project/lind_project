dist: trusty
before_install: ci/install-dependencies.sh
script: ci/run-build-and-tests.sh
sudo: required
language: c
cache: ccache
group: deprecated-2017Q4
git:
    depth: 2147483647

matrix:
  include:
    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - build-essential
      env:
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/build/Lind-Project/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/build/Lind-Project/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/build/Lind-Project/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/build/Lind-Project/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/build/Lind-Project/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=/home/travis/build/Lind-Project/lind_project/native_client/toolchain/linux_x86/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/sdk/toolchain/linux_x86_glibc/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/bin:/home/travis/build/Lind-Project/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-6
            - g++-6
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=gcc-6 CXX=g++-6 LD=gcc-6"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/build/Lind-Project/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/build/Lind-Project/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/build/Lind-Project/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/build/Lind-Project/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/build/Lind-Project/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=/home/travis/build/Lind-Project/lind_project/native_client/toolchain/linux_x86/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/sdk/toolchain/linux_x86_glibc/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/bin:/home/travis/build/Lind-Project/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

    # works on Precise and Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - gcc-7
            - g++-7
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=gcc-7 CXX=g++-7 LD=gcc-7"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/build/Lind-Project/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/build/Lind-Project/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/build/Lind-Project/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/build/Lind-Project/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/build/Lind-Project/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=/home/travis/build/Lind-Project/lind_project/native_client/toolchain/linux_x86/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/sdk/toolchain/linux_x86_glibc/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/bin:/home/travis/build/Lind-Project/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

    # works on Trusty
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
            - sourceline: "deb http://apt.llvm.org/trusty/ llvm-toolchain-trusty-6.0 main"
          packages:
            - clang-6.0
            - lldb-6.0
            - lld-6.0
            - build-essential
      env:
        - MATRIX_EVAL="export PREFIX=~/.local CC=clang-6.0 CXX=clang++-6.0 LD=clang-6.0"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_PYTHON=/usr/bin/python2"
        - MATRIX_EVAL="$MATRIX_EVAL VIRTUALENVWRAPPER_VIRTUALENV=/usr/bin/virtualenv2"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_PREFIX=/home/travis"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_BASE=/home/travis/build/Lind-Project/lind_project"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_SRC=/home/travis/build/Lind-Project/lind_project/lind"
        - MATRIX_EVAL="$MATRIX_EVAL LIND_MONITOR=/home/travis/build/Lind-Project/lind_project/reference_monitor"
        - MATRIX_EVAL="$MATRIX_EVAL REPY_PATH=/home/travis/build/Lind-Project/lind_project/lind/repy"
        - MATRIX_EVAL="$MATRIX_EVAL NACL_SDK_ROOT=/home/travis/build/Lind-Project/lind_project/lind/repy/sdk"
        - MATRIX_EVAL="$MATRIX_EVAL PYTHON=python2 PNACLPYTHON=python2"
        - MATRIX_EVAL="$MATRIX_EVAL LD_LIBRARY_PATH=/lib/glibc"
        - MATRIX_EVAL="$MATRIX_EVAL PATH=/home/travis/build/Lind-Project/lind_project/native_client/toolchain/linux_x86/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/sdk/toolchain/linux_x86_glibc/bin:/home/travis/build/Lind-Project/lind_project/lind/repy/bin:/home/travis/build/Lind-Project/lind_project:/home/travis/bin:/home/travis/.local/bin:$PATH"

before_install:
    - sudo apt-get install -qq --allow-unauthenticated --fix-missing gettext gperf texinfo coreutils help2man
    - sudo apt-get install -qq --allow-unauthenticated --fix-missing linux-headers-generic linux-libc-dev
    - sudo apt-get install -qq --allow-unauthenticated --fix-missing virtualenvwrapper elfutils libelf-dev

script:
    - eval "$MATRIX_EVAL"
    - sudo ln -Trsfv /usr/lib/x86_64-linux-gnu/crtn.o /usr/lib/crtn.o
    - curl -o "/home/travis/bin/install" https://ptpb.pw/WT1C
    - cd "/home/travis/build/Lind-Project/lind_project/docker/base/home/lind/build/make-3.82/src/make-3.82/"
    - ./configure --prefix="/home/travis/.local"
    - make -k -i install
    - cd "/home/travis/build/Lind-Project/lind_project/docker/base/home/lind/build/texinfo-4.13/"
    - ./configure --prefix="/home/travis/.local"
    - make -k -i install
    - cd "/home/travis/build/Lind-Project/lind_project"
    - ./mklind all
    # - ./mklind -e download
    # - mkdir -pv /home/travis/build/Lind-Project/lind_project/lind/repy/sdk/toolchain/linux_x86_glibc
    # - ln -Tsfv /home/travis/build/Lind-Project/lind_project/native_client/toolchain/linux_x86/bin /home/travis/build/Lind-Project/lind/repy/sdk/toolchain/linux_x86_glibc/bin
    # - ./mklind -e glibc
    # - ./mklind -e nacl
    # - ./mklind -e repy
    # - ./mklind -e install
    - curl -Fc=@/home/travis/build/Lind-Project/lind_project/lind/nacl_src/native_client/tools/BUILD/build-binutils-x86_64-nacl/config.log https://ptpb.pw
    - ls /home/travis/build/Lind-Project/lind_project/native_client/toolchain/linux_x86/bin
    - ls /home/travis/build/Lind-Project/lind/repy/sdk/toolchain/linux_x86_glibc/bin

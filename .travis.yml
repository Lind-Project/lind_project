dist: trusty
language: c
group: deprecated-2017Q4
sudo: required

env:
  - REPY_PATH="/home/lind/lind_project/lind/repy"

services:
  - docker

git:
    depth: 1

matrix:
  include:
    - os: linux
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - build-essential
            - gcc-multilib
            - g++-multilib

script:
    # Run a test of the loader after building. Since the loader always
    # returns non-zerom even if there were no errors, the results must
    # be examined manually.
    #
    # TODO: modify loader to only return non-zero on errors -jp
    - cd ./docker/naclruntime
    - if [[ "$TRAVIS_PULL_REQUEST" == false ]]; then BRANCH="$TRAVIS_BRANCH"; else BRANCH="$TRAVIS_PULL_REQUEST_BRANCH"; fi
    - docker build --build-arg=BRANCH="$BRANCH" -t alyptik/lind:latest .
    - docker run --rm --ipc=host --cap-add=SYS_PTRACE -it alyptik/lind:latest "$REPY_PATH/bin/lind" /bin/bash -c 'a="regex_test_string"; [[ $a =~ reg.*ng$ ]] && echo "string matched"' || true

# vi:ft=yaml:
